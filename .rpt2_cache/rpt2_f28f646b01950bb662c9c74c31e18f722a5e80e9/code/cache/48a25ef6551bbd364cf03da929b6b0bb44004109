{"code":"import { checkAllExpired } from './unit';\r\n/**\r\n * 在localStorage中存储数据\r\n * @param key 储存键\r\n * @param value 储存值\r\n * @param expire 过期时间\r\n */\r\nexport var addStorage = function (key, value, expire) {\r\n    if (expire === void 0) { expire = 0; }\r\n    checkAllExpired();\r\n    if (value === '' || value === undefined) {\r\n        value = null;\r\n    }\r\n    expire = (expire ? expire : 0) * 1000;\r\n    var dataId = localStorage.length + 1;\r\n    var Data = {\r\n        id: dataId,\r\n        value: value,\r\n        time: Date.now(),\r\n        expireTime: expire,\r\n        isExpired: false,\r\n    };\r\n    localStorage.setItem(key, JSON.stringify(Data));\r\n};\r\n/**\r\n * 更新localStorage中的数据（注意：这将会给数据进行续活）\r\n * @param key 储存键\r\n * @param value 需要改变的值\r\n * @param expire 需要改变的过期时间\r\n */\r\nexport var changeStorage = function (key, value, expire) {\r\n    checkAllExpired();\r\n    if (value === '' || value === undefined) {\r\n        value = null;\r\n    }\r\n    var prevData = JSON.parse(localStorage.getItem(key));\r\n    if (expire === null || expire === undefined) {\r\n        expire = prevData.expireTime;\r\n    }\r\n    var Data = {\r\n        id: prevData.id,\r\n        value: value,\r\n        time: Date.now(),\r\n        expireTime: expire,\r\n        isExpired: false,\r\n    };\r\n    localStorage.setItem(key, JSON.stringify(Data));\r\n};\r\n/**\r\n * 删除localStorage中的相应数据\r\n * @param key 需要删除的储存键\r\n */\r\nexport var removeStorage = function (key) {\r\n    checkAllExpired();\r\n    localStorage.removeItem(key);\r\n};\r\n/**\r\n * 清空localStorage\r\n */\r\nexport var clearStorage = function () {\r\n    localStorage.clear();\r\n};\r\n/**\r\n * 获取localStorage中所需的数据\r\n * @param key 需要获取的储存键\r\n * @returns 返回该键对应的值\r\n */\r\nexport var getStorage = function (key) {\r\n    checkAllExpired();\r\n    if (localStorage.getItem(key) === null || JSON.stringify(localStorage.getItem(key)) === 'null') {\r\n        return null;\r\n    }\r\n    var storage = JSON.parse(localStorage.getItem(key));\r\n    var now = Date.now();\r\n    if (storage.expire < (now - storage.time)) {\r\n        removeStorage(key);\r\n        return 'Storage expired';\r\n    }\r\n    else {\r\n        return storage.value;\r\n    }\r\n};\r\n/**\r\n * 查询localStorage数据是否过期\r\n * @param key 需要查询的储存键\r\n * @returns 如果储存键没过期，返回true，否则返回false\r\n */\r\nexport var isExpired = function (key) {\r\n    checkAllExpired();\r\n    if (localStorage.getItem(key) === null || JSON.stringify(localStorage.getItem(key)) === 'null') {\r\n        return true;\r\n    }\r\n    var value = JSON.parse(localStorage.getItem(key));\r\n    var now = Date.now();\r\n    if (value.expire && value.expire < (now - value.time)) {\r\n        return true;\r\n    }\r\n    else {\r\n        return false;\r\n    }\r\n};\r\n/**\r\n * 手动让数据过期\r\n * @param key 需要设置过期的数据\r\n * @returns 如果找不到该数据则返回 'Data not found'\r\n */\r\nexport var expireData = function (key) {\r\n    checkAllExpired();\r\n    if (localStorage.getItem(key) === null || JSON.stringify(localStorage.getItem(key)) === 'null') {\r\n        return 'Data not found';\r\n    }\r\n    var value = JSON.parse(localStorage.getItem(key));\r\n    value.isExpired = true;\r\n    localStorage.setItem(key, JSON.stringify(value));\r\n};\r\n/**\r\n * 删除所有过期数据\r\n */\r\nexport var clearExpired = function () {\r\n    var localStorageLength = localStorage.length;\r\n    for (var i = 0; i < localStorageLength; i++) {\r\n        var key = localStorage.key(i);\r\n        var value = JSON.parse(localStorage.getItem(key));\r\n        if (value.isExpired === true) {\r\n            removeStorage(key);\r\n        }\r\n    }\r\n};\r\n/**\r\n * 获取localStorage中的所有未过期数据\r\n * @returns 返回localStorage中的所有数据\r\n */\r\nexport var getAllStorage = function () {\r\n    checkAllExpired();\r\n    var storageLength = localStorage.length;\r\n    var storageArr = [];\r\n    for (var i = 0; i < storageLength; i++) {\r\n        var key = localStorage.key(i);\r\n        var value = JSON.parse(localStorage.getItem(key));\r\n        if (value.isExpired !== true) {\r\n            storageArr.push({\r\n                key: key,\r\n                value: value\r\n            });\r\n        }\r\n        return storageArr;\r\n    }\r\n};\r\n/**\r\n * 获取所有已过期数据\r\n */\r\nexport var getExpiredStorage = function () {\r\n    checkAllExpired();\r\n    var storageLength = localStorage.length;\r\n    var storageArr = [];\r\n    for (var i = 0; i < storageLength; i++) {\r\n        var key = localStorage.key(i);\r\n        var value = JSON.parse(localStorage.getItem(key));\r\n        if (value.isExpired === true) {\r\n            storageArr.push({\r\n                key: key,\r\n                value: value\r\n            });\r\n        }\r\n        return storageArr;\r\n    }\r\n};\r\n","dts":{"name":"/workspaces/pocketjs/index.d.ts","writeByteOrderMark":false,"text":"/**\r\n * 在localStorage中存储数据\r\n * @param key 储存键\r\n * @param value 储存值\r\n * @param expire 过期时间\r\n */\r\nexport declare const addStorage: (key: string, value?: any, expire?: number) => void;\r\n/**\r\n * 更新localStorage中的数据（注意：这将会给数据进行续活）\r\n * @param key 储存键\r\n * @param value 需要改变的值\r\n * @param expire 需要改变的过期时间\r\n */\r\nexport declare const changeStorage: (key: string, value?: any, expire?: number) => void;\r\n/**\r\n * 删除localStorage中的相应数据\r\n * @param key 需要删除的储存键\r\n */\r\nexport declare const removeStorage: (key: string) => void;\r\n/**\r\n * 清空localStorage\r\n */\r\nexport declare const clearStorage: () => void;\r\n/**\r\n * 获取localStorage中所需的数据\r\n * @param key 需要获取的储存键\r\n * @returns 返回该键对应的值\r\n */\r\nexport declare const getStorage: (key: string) => any;\r\n/**\r\n * 查询localStorage数据是否过期\r\n * @param key 需要查询的储存键\r\n * @returns 如果储存键没过期，返回true，否则返回false\r\n */\r\nexport declare const isExpired: (key: string) => boolean;\r\n/**\r\n * 手动让数据过期\r\n * @param key 需要设置过期的数据\r\n * @returns 如果找不到该数据则返回 'Data not found'\r\n */\r\nexport declare const expireData: (key: string) => any;\r\n/**\r\n * 删除所有过期数据\r\n */\r\nexport declare const clearExpired: () => void;\r\n/**\r\n * 获取localStorage中的所有未过期数据\r\n * @returns 返回localStorage中的所有数据\r\n */\r\nexport declare const getAllStorage: () => any[];\r\n/**\r\n * 获取所有已过期数据\r\n */\r\nexport declare const getExpiredStorage: () => any[];\r\n"}}
